<!DOCTYPE html>
<html lang="en" xmlns:th="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HelloMentor-스터디</title>
  <link rel="stylesheet" th:href="@{/css/updateStudy.css}" />


  <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</head>
<body>
<div class="content">
  <div class="section">
    <div class="title">스터디</div>

    <div class="study-detail">
      <div class="study-info">
        <div id="study-info1">
          <span><b th:text="${dstudy.postTitle}"></b></span>
          <div>
            <div id="study-writer" th:text="${dstudy.userNo}"></div>
            <div id="study-create-date" th:text="${dstudy.createDate}"></div>
            <div id="study-count" th:text="'조회수 | ' + ${dstudy.views}"></div>
          </div>
        </div>
        <div id="study-info2">
          <span>현재 참여 인원</span>

          <span th:text="${studyDetailApplicant} +'명/5명'"></span>
        </div>
      </div>

      <div class="study-content" th:text="${dstudy.postContent}"></div>
    </div>


    <!-- 신고하기 링크는 작성자는 안보임-->
    <th:block th:if="${dstudy.userNo != loginUser.userId}">
      <a th:href="@{/report}" class="report-this-board">신고하기</a>
    </th:block>


    <div class="study-btns">
      <button type="button" class="s-btns" id="list-button" onclick="location.href='/hellomentor/study'">
        목록
      </button>
      <!-- 스터디 작성자는 신청이 안보임 -->
      <th:block th:if="${dstudy.userNo != loginUser.userId}">
        <button type="submit" class="s-btns" id="apply-button">신청</button>
      </th:block>
      <!-- 수정, 삭제 버튼은 작성자만 보이게 설정 -->
      <!-- <button type="button" class="s-btns" id="edit-button">수정</button> -->

      <th:block th:if="${dstudy.userNo == loginUser.userId}">
        <button type="button" class="s-btns" id="delete-button">삭제</button>
      </th:block>
    </div>



    <div class="reply-count" id= "rcount" th:text=" '댓글 | ' + ${replyList.size()}"></div>
    <form action="" method="post">
      <div class="reply-write-section">
        <textarea class="reply-write" name="replyContent" id="replyContent"></textarea>
        <button id="reply-send" onclick="insertReply();">등록</button>
      </div>
    </form>

    <table id="reply-list">
      <tbody>
      <th:block th:each="replyList : ${replyList}">
        <tr>
          <td width="550px" th:text="${replyList.replyContent}"></td>
          <td width="80px" th:text="${replyList.userNo}"></td>
          <td width="5px">|</td>
          <td width="100px" th:text="${replyList.createDate}"></td>
          <td width="50px">
            <svg
                    class="trash-logo"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
            >
              <path
                      d="M3 6H21"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
              />
              <path
                      d="M19 6V20C19 21 18 22 17 22H7C6 22 5 21 5 20V6"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
              />
              <path
                      d="M8 6V4C8 3 9 2 10 2H14C15 2 16 3 16 4V6"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
              />
              <path
                      d="M10 11V17"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
              />
              <path
                      d="M14 11V17"
                      stroke="black"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
              />
            </svg>
          </td>
        </tr>
      </th:block>
      </tbody>
    </table>
  </div>
</div>

<script>
      $(document).ready(function () {
        $(".trash-logo").mouseenter(function () {
          $(this).addClass("animate__animated animate__swing");
        });

        $(".trash-logo").mouseleave(function () {
          $(this).removeClass("animate__animated animate__swing");
        });
      });
    </script>


<!-- 댓글 등록 -->
<script>


    function insertReply(){
    	$.ajax({
    		url : "@{/study/insertReply}",
    		data: {
    			refBno : ${postNo},
    			replyContent : ${"#replyContent"}.val()
    		},
    		success : function(result) {
    			if(result == "1"){
    				alert("댓글 등록 성공");
    			}else{
    				alert("댓글 등록 실패");
    			}
    			//댓글 목록 불러와야됨
    			selectReplyList();
    		},
    		complete : function(){
    			$("#replyContent").val("");
    		}
    	})
    }


    //댓글 목록 조회
    const selectReplyList = () => {
    	$.ajax({
    		url : '@{/study/selectReplyList}',
    		data : {bno : ${postNo}},
    		success : function(replyList){
    			let html = "";
    			for(let reply of replyList){
    				html += "<tr>"
    					html += "<td width='550px'>" + reply.replyContent +"</td>"
    					html += "<td width='80px'>" + reply.userNo +"</td>"
    					html += "<td width='5px'>|</td>"
    					html += "<td width='100px'>" + reply.createDate +"</td>"
    					html += "<td width='50px'>"
    					html += "<svg class='trash-logo' xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none'>"
    					html += "<path d='M3 6H21' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' />"
    					html += "<path d='M19 6V20C19 21 18 22 17 22H7C6 22 5 21 5 20V6' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' />"
    					html += "<path d='M8 6V4C8 3 9 2 10 2H14C15 2 16 3 16 4V6' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' />"
    					html += "<path d='M10 11V17' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' />"
    					html += "<path d='M14 11V17' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' />"
    					html += "</svg>"
    					html += "</td>"
    					html += "</tr>"
    			}

    			$("#reply-list tbody").html(html);
    			$("#rcount").html(replyList.length);
    		}
    	})

    }

    </script>
</body>
</html>
